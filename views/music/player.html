<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>Music Player</title>
    <link rel="stylesheet" href="../../assets/css/player.css">
</head>

<body>
    <div class="popup-player">
        <div class="player-left">
            <!-- 로고 -->
            <div class="logo">
                <p>로고</p>
            </div>

            <!-- 앨범 커버, 곡 제목, 가수 이름 -->
            <div class="album-info">
                <img src="../../assets/images/album-cover.png" alt="Album Cover" class="album-cover">
                <h2>곡 제목</h2>
                <p>가수 이름</p>
                <span class="like-icon">&hearts;</span>
            </div>

            <!-- 음악 컨트롤러 -->
            <audio id="audio-player" controls>
                <source id="audio-source" src="../../assets/musicfile/Color_Out_-_Host.mp3" type="audio/mp3">
                Your browser does not support the audio element.
            </audio>

            <!-- 시간 및 컨트롤러 (재생/정지 등) -->
            <div class="controls">
                <div class="time-info">
                    <span id="current-time">00:00</span>
                    <span id="total-time">01:00</span>
                </div>
                <div class="player-buttons">
                    <button class="prev-btn">⏮</button>
                    <button class="play-btn">▶</button>
                    <button class="next-btn">⏭</button>
                </div>
            </div>

            <!-- 음량 조절 슬라이더 -->
            <div class="volume-control">
                <label for="volume-slider">음량:</label>
                <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="1">
            </div>
        </div>
        
        <div class="playlist-right">
            <div class="user-info">
                <span class="user-id">ihs*** 님</span>
                <button class="logout-btn">로그아웃</button>
            </div>

            <!-- 탭 버튼들 -->
            <div class="tab-header">
                <button id="playlist-tab" class="active">재생목록 (7)</button>
                <button id="my-music-tab">마이뮤직</button>
            </div>

            <!-- 재생목록 -->
            <div id="playlist-content" class="tab-content active">
                <ul class="playlist" id="playlist">
                    <!-- Mock 데이터가 동적으로 여기에 추가됨 -->
                </ul>
                <div class="playlist-footer">
                    <button>담기</button>
                    <button>삭제</button>
                    <p id="song-count">0곡 / 1곡</p>
                </div>
            </div>

            <!-- 마이뮤직 -->
            <div id="my-music-content" class="tab-content">
                <ul class="playlist" id="my-music">
                    <li><input type="checkbox"> 나의 음악 1</li>
                    <li><input type="checkbox"> 나의 음악 2</li>
                    <li><input type="checkbox"> 나의 음악 3</li>
                </ul>
                <div class="playlist-footer">
                    <button>담기</button>
                    <button>삭제</button>
                    <p>0곡 / 3곡</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const playlistTab = document.getElementById('playlist-tab');
        const myMusicTab = document.getElementById('my-music-tab');
        const playlistContent = document.getElementById('playlist-content');
        const myMusicContent = document.getElementById('my-music-content');
        const playlist = document.getElementById('playlist');
        const currentSongDisplay = document.getElementById('current-song');
        const audioPlayer = document.getElementById('audio-player');
        const audioSource = document.getElementById('audio-source');
        const volumeSlider = document.getElementById('volume-slider');
        const songCount = document.getElementById('song-count');

        // 음량 슬라이더 값 변경 시 실행되는 함수
        volumeSlider.addEventListener('input', function () {
            audioPlayer.volume = volumeSlider.value;
        });

        // Mock 데이터 (나중에 실제 API로 대체 가능)
        const songs = [
            { id: 1, title: "HAPPY", artist: "DAY6", url: "song1.mp3" },
            { id: 2, title: "Welcome to the Show", artist: "DAY6", url: "song2.mp3" },
            { id: 3, title: "한 페이지가 될 수 있게", artist: "DAY6", url: "song3.mp3" },
            { id: 4, title: "Supernova", artist: "aespa", url: "song4.mp3" },
            { id: 5, title: "소나기", artist: "이클립스", url: "song5.mp3" }
        ];

        // 재생 목록 생성
        function loadPlaylist() {
            playlist.innerHTML = ''; // 초기화
            songs.forEach((song, index) => {
                const li = document.createElement('li');
                li.innerHTML = `<input type="checkbox"> ${song.title} - ${song.artist} <button data-index="${index}" class="play-btn">재생</button>`;
                playlist.appendChild(li);
            });
            updateSongCount();
        }

        // 노래 재생
        function playSong(index) {
            const song = songs[index];
            audioSource.src = song.url;
            audioPlayer.load();
            audioPlayer.play();
            currentSongDisplay.textContent = `${song.title} - ${song.artist}`;
        }

        // 재생 버튼 클릭 이벤트
        playlist.addEventListener('click', function (e) {
            if (e.target.classList.contains('play-btn')) {
                const index = e.target.getAttribute('data-index');
                playSong(index);
            }
        });

        // 탭 전환 기능
        playlistTab.addEventListener('click', function () {
            playlistTab.classList.add('active');
            myMusicTab.classList.remove('active');

            playlistContent.classList.add('active');
            myMusicContent.classList.remove('active');
        });

        myMusicTab.addEventListener('click', function () {
            myMusicTab.classList.add('active');
            playlistTab.classList.remove('active');

            myMusicContent.classList.add('active');
            playlistContent.classList.remove('active');
        });

        // URL에서 쿼리 파라미터 읽어오기
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        // 페이지 로드 시 URL 파라미터로 노래 정보 설정
        window.onload = function () {
            const title = getQueryParam('title');
            const artist = getQueryParam('artist');
            const songUrl = getQueryParam('songUrl');

            if (title && artist && songUrl) {
                currentSongDisplay.textContent = `${title} - ${artist}`;
                audioSource.src = songUrl;
                audioPlayer.load();
                audioPlayer.play();
                addSongToPlaylist(title, artist, songUrl);
            }

            loadPlaylist();
        };

        // 새로운 곡을 플레이리스트에 추가하는 함수
        function addSongToPlaylist(title, artist, url) {
            const li = document.createElement('li');
            li.innerHTML = `<input type="checkbox"> ${title} - ${artist} <button class="play-btn">재생</button>`;
            playlist.appendChild(li);
            updateSongCount();
        }

        // 현재 재생목록 곡 수 업데이트
        function updateSongCount() {
            const songCountValue = playlist.querySelectorAll('li').length;
            songCount.textContent = `${songCountValue}곡 / ${songs.length}곡`;
        }
    </script>

</body>

</html>
